{% extends "base.html" %}

{% block title %}Patronenwechsel Anleitung - WartungsManager{% endblock %}

{% block content %}
<style>
.step-container {
    margin-bottom: 2rem;
}

.step-card {
    border: 2px solid #dee2e6;
    border-radius: 12px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.step-card.active {
    border-color: #007bff;
    box-shadow: 0 4px 12px rgba(0,123,255,0.2);
}

.step-card.completed {
    border-color: #28a745;
    background-color: #f8fff9;
}

.step-number {
    width: 40px;
    height: 40px;
    background: #6c757d;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
}

.step-card.active .step-number {
    background: #007bff;
}

.step-card.completed .step-number {
    background: #28a745;
}

.step-content {
    display: none;
    padding: 1rem;
    border-top: 1px solid #dee2e6;
}

.step-card.active .step-content {
    display: block;
}

.warning-box {
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
}

.danger-box {
    background: #f8d7da;
    border: 2px solid #dc3545;
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
}

.checklist-item {
    padding: 0.5rem;
    margin: 0.25rem 0;
    border-radius: 4px;
    cursor: pointer;
}

.checklist-item:hover {
    background: #f8f9fa;
}

.checklist-item input[type="checkbox"] {
    margin-right: 0.5rem;
}

.timer-display {
    font-size: 2rem;
    font-weight: bold;
    color: #dc3545;
    font-family: 'Courier New', monospace;
}

@media print {
    .no-print {
        display: none !important;
    }
    
    .step-content {
        display: block !important;
    }
    
    .step-card {
        page-break-inside: avoid;
    }
}
</style>

<!-- Header -->
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/k14/dokumentation">K14 Dokumentation</a></li>
                <li class="breadcrumb-item"><a href="/k14/wartungsintervalle">Wartungsintervalle</a></li>
                <li class="breadcrumb-item active">Patronenwechsel</li>
            </ol>
        </nav>
        <h1 class="display-4">
            <i class="fas fa-filter me-3"></i>Patronenwechsel Schritt-für-Schritt
        </h1>
        <p class="lead">Interaktive Anleitung für den sicheren Patronenwechsel am K14 Kompressor</p>
    </div>
</div>

<!-- Sicherheitshinweis -->
<div class="danger-box mb-4">
    <h5><i class="fas fa-exclamation-triangle me-2"></i>WICHTIGE SICHERHEITSHINWEISE</h5>
    <ul class="mb-0">
        <li>Kompressor MUSS vollständig drucklos sein</li>
        <li>Mindestens 30 Minuten Abkühlzeit einhalten</li>
        <li>Persönliche Schutzausrüstung tragen (Handschuhe, Schutzbrille)</li>
        <li>Niemals unter Druck arbeiten!</li>
    </ul>
</div>

<!-- Fortschrittsanzeige -->
<div class="row mb-4">
    <div class="col-12">
        <div class="progress" style="height: 30px;">
            <div class="progress-bar" id="fortschritt" role="progressbar" style="width: 0%">
                0% abgeschlossen
            </div>
        </div>
    </div>
</div>

<!-- Schritte -->
<div class="step-container">
    <!-- Schritt 1: Vorbereitung -->
    <div class="step-card" id="step-1" onclick="toggleStep(1)">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="step-number me-3">1</div>
                <div class="flex-grow-1">
                    <h5 class="mb-0">Vorbereitung</h5>
                    <small class="text-muted">Kompressor abschalten und vorbereiten</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
        <div class="step-content">
            <div class="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-1-1">
                    <label for="check-1-1">Kompressor ausschalten (Hauptschalter)</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-1-2">
                    <label for="check-1-2">Alle Ventile öffnen - Druck ablassen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-1-3">
                    <label for="check-1-3">Manometer prüfen - muss 0 bar anzeigen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-1-4">
                    <label for="check-1-4">Stromzufuhr trennen (Stecker ziehen)</label>
                </div>
            </div>
            
            <div class="warning-box mt-3">
                <strong>Abkühlzeit:</strong> Jetzt 30 Minuten warten!
                <div class="timer-display" id="timer">30:00</div>
                <button class="btn btn-warning btn-sm" onclick="startTimer()">
                    <i class="fas fa-clock me-1"></i>Timer starten
                </button>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="nextStep(1)" disabled id="btn-step-1">
                    Weiter zu Schritt 2 <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Schritt 2: Werkzeug -->
    <div class="step-card mt-3" id="step-2" onclick="toggleStep(2)">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="step-number me-3">2</div>
                <div class="flex-grow-1">
                    <h5 class="mb-0">Werkzeug & Material</h5>
                    <small class="text-muted">Alles bereitstellen</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
        <div class="step-content">
            <h6>Benötigtes Werkzeug:</h6>
            <div class="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-2-1">
                    <label for="check-2-1">Drehmomentschlüssel (Bereich: 20-60 Nm)</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-2-2">
                    <label for="check-2-2">Passende Nüsse für Patronenverschlüsse</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-2-3">
                    <label for="check-2-3">Neue Patronen (beide!)</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-2-4">
                    <label for="check-2-4">Neue Dichtungen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-2-5">
                    <label for="check-2-5">Reinigungstücher</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-2-6">
                    <label for="check-2-6">Schutzhandschuhe & Schutzbrille</label>
                </div>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="nextStep(2)">
                    Weiter zu Schritt 3 <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Schritt 3: Demontage -->
    <div class="step-card mt-3" id="step-3" onclick="toggleStep(3)">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="step-number me-3">3</div>
                <div class="flex-grow-1">
                    <h5 class="mb-0">Alte Patronen entfernen</h5>
                    <small class="text-muted">Vorsichtig demontieren</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
        <div class="step-content">
            <div class="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-3-1">
                    <label for="check-3-1">Oberen Patronenverschluss lösen (gegen Uhrzeigersinn)</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-3-2">
                    <label for="check-3-2">Erste Patrone vorsichtig herausnehmen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-3-3">
                    <label for="check-3-3">Unteren Patronenverschluss lösen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-3-4">
                    <label for="check-3-4">Zweite Patrone herausnehmen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-3-5">
                    <label for="check-3-5">Alte Patronen in Entsorgungsbehälter legen</label>
                </div>
            </div>
            
            <div class="warning-box mt-3">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Hinweis:</strong> Alte Patronen können Feuchtigkeit enthalten. Vorsichtig handhaben!
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="nextStep(3)">
                    Weiter zu Schritt 4 <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Schritt 4: Reinigung -->
    <div class="step-card mt-3" id="step-4" onclick="toggleStep(4)">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="step-number me-3">4</div>
                <div class="flex-grow-1">
                    <h5 class="mb-0">Reinigung & Inspektion</h5>
                    <small class="text-muted">Gründlich säubern und prüfen</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
        <div class="step-content">
            <div class="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-4-1">
                    <label for="check-4-1">Patronengehäuse innen reinigen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-4-2">
                    <label for="check-4-2">Gewinde auf Beschädigungen prüfen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-4-3">
                    <label for="check-4-3">Alte Dichtungen entfernen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-4-4">
                    <label for="check-4-4">Dichtflächen reinigen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-4-5">
                    <label for="check-4-5">Neue Dichtungen einlegen</label>
                </div>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="nextStep(4)">
                    Weiter zu Schritt 5 <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Schritt 5: Montage -->
    <div class="step-card mt-3" id="step-5" onclick="toggleStep(5)">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="step-number me-3">5</div>
                <div class="flex-grow-1">
                    <h5 class="mb-0">Neue Patronen einbauen</h5>
                    <small class="text-muted">Korrekt montieren</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
        <div class="step-content">
            <div class="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-5-1">
                    <label for="check-5-1">Untere Patrone vorsichtig einsetzen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-5-2">
                    <label for="check-5-2">Unteren Verschluss handfest anziehen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-5-3">
                    <label for="check-5-3">Obere Patrone einsetzen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-5-4">
                    <label for="check-5-4">Oberen Verschluss handfest anziehen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-5-5">
                    <label for="check-5-5">Beide Verschlüsse mit Drehmomentschlüssel anziehen (45 Nm)</label>
                </div>
            </div>
            
            <div class="danger-box mt-3">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>WICHTIG:</strong> Nicht überdrehen! Exakt 45 Nm verwenden!
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="nextStep(5)">
                    Weiter zu Schritt 6 <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Schritt 6: Abschluss -->
    <div class="step-card mt-3" id="step-6" onclick="toggleStep(6)">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="step-number me-3">6</div>
                <div class="flex-grow-1">
                    <h5 class="mb-0">Abschluss & Test</h5>
                    <small class="text-muted">Funktionsprüfung und Dokumentation</small>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
        <div class="step-content">
            <div class="checklist">
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-6-1">
                    <label for="check-6-1">Stromzufuhr wieder herstellen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-6-2">
                    <label for="check-6-2">Kompressor einschalten</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-6-3">
                    <label for="check-6-3">5 Minuten Testlauf durchführen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-6-4">
                    <label for="check-6-4">Auf Leckagen prüfen</label>
                </div>
                <div class="checklist-item" onclick="toggleCheck(this)">
                    <input type="checkbox" id="check-6-5">
                    <label for="check-6-5">Erste Füllung verwerfen (Spülung)</label>
                </div>
            </div>
            
            <div class="warning-box mt-3">
                <i class="fas fa-clipboard-check me-2"></i>
                <strong>Dokumentation:</strong> Wartungsintervall im System zurücksetzen!
            </div>
            
            <div class="mt-3">
                <a href="/patronenwechsel" class="btn btn-success">
                    <i class="fas fa-check me-2"></i>Wartung im System dokumentieren
                </a>
                <button class="btn btn-secondary ms-2" onclick="window.print()">
                    <i class="fas fa-print me-2"></i>Anleitung drucken
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Zusammenfassung -->
<div class="card mt-4" id="zusammenfassung" style="display: none;">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">
            <i class="fas fa-check-circle me-2"></i>Patronenwechsel abgeschlossen!
        </h5>
    </div>
    <div class="card-body">
        <p>Glückwunsch! Sie haben den Patronenwechsel erfolgreich durchgeführt.</p>
        <h6>Wichtige Erinnerungen:</h6>
        <ul>
            <li>Wartungsintervall im System zurücksetzen (Passwort: Magicfactory15!)</li>
            <li>Alte Patronen ordnungsgemäß entsorgen</li>
            <li>Nächster Patronenwechsel in 100 Betriebsstunden</li>
        </ul>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
let currentStep = 0;
let timerInterval = null;
let timerSeconds = 1800; // 30 Minuten

// Schritt umschalten
function toggleStep(stepNum) {
    const step = document.getElementById(`step-${stepNum}`);
    const wasActive = step.classList.contains('active');
    
    // Alle anderen schließen
    document.querySelectorAll('.step-card').forEach(card => {
        card.classList.remove('active');
    });
    
    // Aktuellen öffnen/schließen
    if (!wasActive && stepNum <= currentStep + 1) {
        step.classList.add('active');
    }
}

// Nächster Schritt
function nextStep(stepNum) {
    // Aktuellen Schritt als abgeschlossen markieren
    document.getElementById(`step-${stepNum}`).classList.add('completed');
    document.getElementById(`step-${stepNum}`).classList.remove('active');
    
    // Nächsten Schritt aktivieren
    currentStep = stepNum;
    if (stepNum < 6) {
        const nextStepElement = document.getElementById(`step-${stepNum + 1}`);
        nextStepElement.classList.add('active');
        nextStepElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        // Alle Schritte abgeschlossen
        document.getElementById('zusammenfassung').style.display = 'block';
        document.getElementById('zusammenfassung').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Fortschritt aktualisieren
    updateProgress();
}

// Fortschritt aktualisieren
function updateProgress() {
    const totalSteps = 6;
    const completedSteps = document.querySelectorAll('.step-card.completed').length;
    const percentage = (completedSteps / totalSteps) * 100;
    
    const progressBar = document.getElementById('fortschritt');
    progressBar.style.width = percentage + '%';
    progressBar.textContent = Math.round(percentage) + '% abgeschlossen';
}

// Checkbox toggle
function toggleCheck(element) {
    const checkbox = element.querySelector('input[type="checkbox"]');
    checkbox.checked = !checkbox.checked;
    
    // Prüfe ob alle Checkboxen in Schritt 1 gecheckt sind
    if (element.closest('#step-1')) {
        const allChecked = document.querySelectorAll('#step-1 input[type="checkbox"]:checked').length === 4;
        if (allChecked && timerSeconds === 0) {
            document.getElementById('btn-step-1').disabled = false;
        }
    }
}

// Timer funktionen
function startTimer() {
    if (timerInterval) return;
    
    timerInterval = setInterval(() => {
        timerSeconds--;
        
        if (timerSeconds <= 0) {
            clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById('timer').textContent = 'Abkühlzeit erreicht!';
            document.getElementById('timer').style.color = '#28a745';
            
            // Prüfe ob alle Checkboxen gecheckt sind
            const allChecked = document.querySelectorAll('#step-1 input[type="checkbox"]:checked').length === 4;
            if (allChecked) {
                document.getElementById('btn-step-1').disabled = false;
            }
            return;
        }
        
        const minutes = Math.floor(timerSeconds / 60);
        const seconds = timerSeconds % 60;
        document.getElementById('timer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }, 1000);
}

// Initialisierung
document.addEventListener('DOMContentLoaded', function() {
    // Ersten Schritt aktivieren
    toggleStep(1);
});

// Verhindern des Schließens bei aktivem Timer
window.addEventListener('beforeunload', function(e) {
    if (timerInterval) {
        e.preventDefault();
        e.returnValue = 'Timer läuft noch. Wirklich verlassen?';
    }
});
</script>
{% endblock %}

**Erstellt von Hans Hahn - Alle Rechte vorbehalten**
