{% extends "base.html" %}\n\n{% block title %}Kunden-Import - WartungsManager{% endblock %}\n\n{% block content %}\n<!-- Kunden-Import Header -->\n<div class="row mb-4">\n    <div class="col-12">\n        <h1 class="display-4 text-center mb-4">\n            <i class="fas fa-upload me-3"></i>Kunden-Import\n        </h1>\n        <p class="text-center text-muted fs-5">Kunden aus CSV- oder Excel-Dateien importieren</p>\n    </div>\n</div>\n\n<!-- Import-Wizard -->\n<div class="row">\n    <div class="col-12">\n        <div class="card">\n            <div class="card-header bg-primary text-white">\n                <div class="row align-items-center">\n                    <div class="col-md-8">\n                        <h5 class="mb-0">\n                            <i class="fas fa-file-import me-2"></i>Import-Assistent\n                        </h5>\n                    </div>\n                    <div class="col-md-4 text-end">\n                        <span class="badge bg-light text-dark" id="import-step">Schritt 1 von 3</span>\n                    </div>\n                </div>\n            </div>\n            <div class="card-body">\n                <!-- Schritt 1: Datei-Upload und Info -->\n                <div id="step-1" class="import-step">\n                    <div class="row">\n                        <!-- Upload-Bereich -->\n                        <div class="col-md-8">\n                            <h6 class="mb-3">\n                                <i class="fas fa-cloud-upload-alt me-2"></i>Datei hochladen\n                            </h6>\n                            \n                            <div class="upload-area border border-dashed border-primary rounded p-4 text-center mb-4" \n                                 id="upload-area" \n                                 ondrop="handleDrop(event)" \n                                 ondragover="handleDragOver(event)" \n                                 ondragleave="handleDragLeave(event)">\n                                <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>\n                                <h5>Datei hier hinziehen oder klicken zum Auswählen</h5>\n                                <p class="text-muted mb-3">\n                                    Unterstützte Formate: CSV, Excel (.xlsx, .xls)<br>\n                                    Maximale Größe: 5 MB\n                                </p>\n                                <input type="file" id="file-input" class="d-none" \n                                       accept=".csv,.xlsx,.xls" onchange="handleFileSelect(event)">\n                                <button type="button" class="btn btn-primary" onclick="document.getElementById(\'file-input\').click()">\n                                    <i class="fas fa-folder-open me-2"></i>Datei auswählen\n                                </button>\n                            </div>\n                            \n                            <!-- Datei-Info -->\n                            <div id="file-info" class="alert alert-info" style="display: none;">\n                                <div class="row align-items-center">\n                                    <div class="col-md-8">\n                                        <strong id="file-name">-</strong><br>\n                                        <small>Größe: <span id="file-size">-</span> | Format: <span id="file-format">-</span></small>\n                                    </div>\n                                    <div class="col-md-4 text-end">\n                                        <button class="btn btn-success" onclick="processFile()">\n                                            <i class="fas fa-search me-2"></i>Analysieren\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <!-- Info-Panel -->\n                        <div class="col-md-4">\n                            <div class="card border-info">\n                                <div class="card-header bg-info text-white">\n                                    <h6 class="mb-0">\n                                        <i class="fas fa-info-circle me-2"></i>Import-Format\n                                    </h6>\n                                </div>\n                                <div class="card-body">\n                                    <h6>Erforderliche Spalten:</h6>\n                                    <ul class="list-unstyled mb-3">\n                                        <li><i class="fas fa-check text-success me-2"></i><strong>vorname</strong> (Pflicht)</li>\n                                    </ul>\n                                    \n                                    <h6>Optionale Spalten:</h6>\n                                    <ul class="list-unstyled mb-3">\n                                        <li><i class="fas fa-circle text-muted me-2"></i>nachname</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>telefon</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>email</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>adresse</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>externe_kundennummer</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>externe_system</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>mitgliedschaft_typ</li>\n                                        <li><i class="fas fa-circle text-muted me-2"></i>notizen</li>\n                                    </ul>\n                                    \n                                    <div class="d-grid">\n                                        <a href="/api/kunden/import/template" class="btn btn-outline-info btn-sm">\n                                            <i class="fas fa-download me-2"></i>Template herunterladen\n                                        </a>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Schritt 2: Vorschau und Mapping -->\n                <div id="step-2" class="import-step" style="display: none;">\n                    <h6 class="mb-3">\n                        <i class="fas fa-eye me-2"></i>Vorschau und Spalten-Zuordnung\n                    </h6>\n                    \n                    <!-- Statistiken -->\n                    <div class="row mb-4">\n                        <div class="col-md-3">\n                            <div class="card border-primary text-center">\n                                <div class="card-body">\n                                    <h3 class="text-primary" id="preview-total-rows">0</h3>\n                                    <small>Zeilen gesamt</small>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="col-md-3">\n                            <div class="card border-success text-center">\n                                <div class="card-body">\n                                    <h3 class="text-success" id="preview-mapped-columns">0</h3>\n                                    <small>Erkannte Spalten</small>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="col-md-3">\n                            <div class="card border-warning text-center">\n                                <div class="card-body">\n                                    <h3 class="text-warning" id="preview-warnings">0</h3>\n                                    <small>Warnungen</small>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="col-md-3">\n                            <div class="card border-danger text-center">\n                                <div class="card-body">\n                                    <h3 class="text-danger" id="preview-errors">0</h3>\n                                    <small>Fehler</small>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Spalten-Mapping -->\n                    <div class="card mb-4">\n                        <div class="card-header">\n                            <h6 class="mb-0">Automatische Spalten-Zuordnung</h6>\n                        </div>\n                        <div class="card-body">\n                            <div id="column-mapping" class="row">\n                                <!-- Wird dynamisch gefüllt -->\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Daten-Vorschau -->\n                    <div class="card mb-4">\n                        <div class="card-header">\n                            <h6 class="mb-0">Daten-Vorschau (erste 10 Zeilen)</h6>\n                        </div>\n                        <div class="card-body">\n                            <div id="data-preview" class="table-responsive">\n                                <!-- Wird dynamisch gefüllt -->\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Fehler und Warnungen -->\n                    <div id="preview-messages" style="display: none;">\n                        <!-- Wird dynamisch gefüllt -->\n                    </div>\n                    \n                    <!-- Navigation -->\n                    <div class="row">\n                        <div class="col-md-6">\n                            <button class="btn btn-secondary" onclick="showStep(1)">\n                                <i class="fas fa-arrow-left me-2"></i>Zurück\n                            </button>\n                        </div>\n                        <div class="col-md-6 text-end">\n                            <button class="btn btn-success" id="btn-continue-import" onclick="showStep(3)" disabled>\n                                <i class="fas fa-arrow-right me-2"></i>Import starten\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                \n                <!-- Schritt 3: Import-Optionen und Ausführung -->\n                <div id="step-3" class="import-step" style="display: none;">\n                    <h6 class="mb-3">\n                        <i class="fas fa-cogs me-2"></i>Import-Optionen\n                    </h6>\n                    \n                    <div class="row mb-4">\n                        <div class="col-md-6">\n                            <div class="card">\n                                <div class="card-header">\n                                    <h6 class="mb-0">Duplikat-Behandlung</h6>\n                                </div>\n                                <div class="card-body">\n                                    <div class="form-check mb-2">\n                                        <input class="form-check-input" type="radio" name="duplicate-handling" \n                                               id="skip-duplicates" value="skip" checked>\n                                        <label class="form-check-label" for="skip-duplicates">\n                                            <strong>Duplikate überspringen</strong><br>\n                                            <small class="text-muted">Vorhandene Kunden werden nicht verändert</small>\n                                        </label>\n                                    </div>\n                                    <div class="form-check mb-2">\n                                        <input class="form-check-input" type="radio" name="duplicate-handling" \n                                               id="update-duplicates" value="update">\n                                        <label class="form-check-label" for="update-duplicates">\n                                            <strong>Duplikate aktualisieren</strong><br>\n                                            <small class="text-muted">Vorhandene Kunden werden überschrieben</small>\n                                        </label>\n                                    </div>\n                                    <div class="form-check">\n                                        <input class="form-check-input" type="radio" name="duplicate-handling" \n                                               id="import-all" value="all">\n                                        <label class="form-check-label" for="import-all">\n                                            <strong>Alle importieren</strong><br>\n                                            <small class="text-muted">Duplikate mit neuer Mitgliedsnummer erstellen</small>\n                                        </label>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="col-md-6">\n                            <div class="card">\n                                <div class="card-header">\n                                    <h6 class="mb-0">Import-Zusammenfassung</h6>\n                                </div>\n                                <div class="card-body">\n                                    <ul class="list-unstyled">\n                                        <li><strong>Datei:</strong> <span id="summary-filename">-</span></li>\n                                        <li><strong>Zeilen:</strong> <span id="summary-rows">-</span></li>\n                                        <li><strong>Geschätzte neue Kunden:</strong> <span id="summary-new">-</span></li>\n                                        <li><strong>Erkannte Spalten:</strong> <span id="summary-columns">-</span></li>\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Import-Button -->\n                    <div class="text-center mb-4">\n                        <button class="btn btn-success btn-lg" id="btn-execute-import" onclick="executeImport()">\n                            <i class="fas fa-play me-2"></i>Import jetzt ausführen\n                        </button>\n                    </div>\n                    \n                    <!-- Import-Progress -->\n                    <div id="import-progress" style="display: none;">\n                        <div class="card border-info">\n                            <div class="card-body text-center">\n                                <div class="spinner-border text-primary mb-3" role="status">\n                                    <span class="visually-hidden">Import läuft...</span>\n                                </div>\n                                <h5>Import wird durchgeführt...</h5>\n                                <p class="text-muted">Bitte warten Sie, während die Kunden importiert werden.</p>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Import-Ergebnis -->\n                    <div id="import-result" style="display: none;">\n                        <!-- Wird dynamisch gefüllt -->\n                    </div>\n                    \n                    <!-- Navigation -->\n                    <div class="row">\n                        <div class="col-md-6">\n                            <button class="btn btn-secondary" onclick="showStep(2)">\n                                <i class="fas fa-arrow-left me-2"></i>Zurück\n                            </button>\n                        </div>\n                        <div class="col-md-6 text-end">\n                            <a href="/kunden" class="btn btn-primary">\n                                <i class="fas fa-users me-2"></i>Zu den Kunden\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<!-- Navigation -->\n<div class="row mt-4">\n    <div class="col-12 text-center">\n        <a href="/kunden" class="btn btn-secondary btn-touch me-3">\n            <i class="fas fa-arrow-left me-2"></i>Zurück zur Kunden-Übersicht\n        </a>\n        <a href="/" class="btn btn-outline-secondary btn-touch">\n            <i class="fas fa-home me-2"></i>Zum Dashboard\n        </a>\n    </div>\n</div>\n\n<!-- Toast Container -->\n<div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">\n    <!-- Toasts werden hier dynamisch eingefügt -->\n</div>\n\n{% endblock %}\n\n{% block scripts %}\n<script>\n// ============================================================================\n// KUNDEN-IMPORT JAVASCRIPT\n// ============================================================================\n\nlet selectedFile = null;\nlet previewData = null;\n\n// ============================================================================\n// DATEI-UPLOAD HANDLING\n// ============================================================================\n\nfunction handleDragOver(event) {\n    event.preventDefault();\n    document.getElementById(\'upload-area\').classList.add(\'border-success\', \'bg-light\');\n}\n\nfunction handleDragLeave(event) {\n    event.preventDefault();\n    document.getElementById(\'upload-area\').classList.remove(\'border-success\', \'bg-light\');\n}\n\nfunction handleDrop(event) {\n    event.preventDefault();\n    document.getElementById(\'upload-area\').classList.remove(\'border-success\', \'bg-light\');\n    \n    const files = event.dataTransfer.files;\n    if (files.length > 0) {\n        handleFile(files[0]);\n    }\n}\n\nfunction handleFileSelect(event) {\n    const files = event.target.files;\n    if (files.length > 0) {\n        handleFile(files[0]);\n    }\n}\n\nfunction handleFile(file) {\n    // Datei-Validierung\n    const allowedTypes = [\'text/csv\', \'application/vnd.ms-excel\', \'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\'];\n    const maxSize = 5 * 1024 * 1024; // 5MB\n    \n    if (!allowedTypes.includes(file.type) && !file.name.match(/\\.(csv|xlsx|xls)$/i)) {\n        showErrorMessage(\'Ungültiges Dateiformat. Nur CSV und Excel-Dateien sind erlaubt.\');\n        return;\n    }\n    \n    if (file.size > maxSize) {\n        showErrorMessage(\'Datei zu groß. Maximale Größe: 5 MB\');\n        return;\n    }\n    \n    selectedFile = file;\n    \n    // Datei-Info anzeigen\n    document.getElementById(\'file-name\').textContent = file.name;\n    document.getElementById(\'file-size\').textContent = formatFileSize(file.size);\n    document.getElementById(\'file-format\').textContent = getFileExtension(file.name).toUpperCase();\n    document.getElementById(\'file-info\').style.display = \'block\';\n    \n    showSuccessMessage(\'Datei ausgewählt: \' + file.name);\n}\n\nfunction formatFileSize(bytes) {\n    if (bytes === 0) return \'0 Bytes\';\n    const k = 1024;\n    const sizes = [\'Bytes\', \'KB\', \'MB\', \'GB\'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \' \' + sizes[i];\n}\n\nfunction getFileExtension(filename) {\n    return filename.split(\'.\').pop().toLowerCase();\n}\n\n// ============================================================================\n// IMPORT-WIZARD NAVIGATION\n// ============================================================================\n\nfunction showStep(step) {\n    // Alle Schritte verstecken\n    document.querySelectorAll(\'.import-step\').forEach(el => {\n        el.style.display = \'none\';\n    });\n    \n    // Gewünschten Schritt anzeigen\n    document.getElementById(\'step-\' + step).style.display = \'block\';\n    \n    // Schritt-Anzeige aktualisieren\n    document.getElementById(\'import-step\').textContent = `Schritt ${step} von 3`;\n}\n\n// ============================================================================\n// DATEI-VERARBEITUNG UND VORSCHAU\n// ============================================================================\n\nasync function processFile() {\n    if (!selectedFile) {\n        showErrorMessage(\'Keine Datei ausgewählt\');\n        return;\n    }\n    \n    try {\n        const formData = new FormData();\n        formData.append(\'file\', selectedFile);\n        \n        showInfoMessage(\'Datei wird analysiert...\');\n        \n        const response = await fetch(\'/api/kunden/import/preview\', {\n            method: \'POST\',\n            body: formData\n        });\n        \n        const result = await response.json();\n        \n        if (result.success) {\n            previewData = result.preview;\n            displayPreview(result.preview);\n            showStep(2);\n            showSuccessMessage(\'Datei erfolgreich analysiert\');\n        } else {\n            showErrorMessage(\'Fehler beim Analysieren: \' + result.error);\n        }\n        \n    } catch (error) {\n        console.error(\'Fehler beim Verarbeiten:\', error);\n        showErrorMessage(\'Netzwerkfehler beim Verarbeiten der Datei\');\n    }\n}\n\nfunction displayPreview(preview) {\n    // Statistiken aktualisieren\n    document.getElementById(\'preview-total-rows\').textContent = preview.stats.total_rows;\n    document.getElementById(\'preview-mapped-columns\').textContent = preview.stats.mapped_columns;\n    document.getElementById(\'preview-warnings\').textContent = preview.warnings.length;\n    document.getElementById(\'preview-errors\').textContent = preview.errors.length;\n    \n    // Spalten-Mapping anzeigen\n    displayColumnMapping(preview.column_mapping, preview.stats.available_columns);\n    \n    // Daten-Vorschau anzeigen\n    displayDataPreview(preview.data);\n    \n    // Nachrichten anzeigen\n    displayPreviewMessages(preview.errors, preview.warnings);\n    \n    // Import-Button aktivieren/deaktivieren\n    const canImport = preview.can_import;\n    document.getElementById(\'btn-continue-import\').disabled = !canImport;\n    \n    // Zusammenfassung für Schritt 3 vorbereiten\n    document.getElementById(\'summary-filename\').textContent = selectedFile.name;\n    document.getElementById(\'summary-rows\').textContent = preview.stats.total_rows;\n    document.getElementById(\'summary-new\').textContent = preview.stats.estimated_new_customers;\n    document.getElementById(\'summary-columns\').textContent = Object.keys(preview.column_mapping).join(\', \');\n}\n\nfunction displayColumnMapping(mapping, availableColumns) {\n    const container = document.getElementById(\'column-mapping\');\n    let html = \'\';\n    \n    // Erkannte Spalten\n    const mappedCols = Object.keys(mapping);\n    const unmappedCols = availableColumns.filter(col => !Object.values(mapping).includes(col));\n    \n    html += \'<div class="col-md-6"><h6 class="text-success">Erkannte Spalten:</h6><ul class="list-unstyled">\';\n    for (const [target, source] of Object.entries(mapping)) {\n        const isRequired = target === \'vorname\';\n        const icon = isRequired ? \'fas fa-check text-success\' : \'fas fa-circle text-primary\';\n        html += `<li><i class="${icon} me-2"></i><strong>${target}</strong> ← ${source}</li>`;\n    }\n    html += \'</ul></div>\';\n    \n    if (unmappedCols.length > 0) {\n        html += \'<div class="col-md-6"><h6 class="text-warning">Nicht zugeordnete Spalten:</h6><ul class="list-unstyled">\';\n        unmappedCols.forEach(col => {\n            html += `<li><i class="fas fa-question text-warning me-2"></i>${col}</li>`;\n        });\n        html += \'</ul></div>\';\n    }\n    \n    container.innerHTML = html;\n}\n\nfunction displayDataPreview(data) {\n    const container = document.getElementById(\'data-preview\');\n    \n    if (data.length === 0) {\n        container.innerHTML = \'<p class="text-muted">Keine Daten zum Anzeigen</p>\';\n        return;\n    }\n    \n    // Tabelle erstellen\n    const columns = Object.keys(data[0]);\n    let html = \'<table class="table table-striped table-sm"><thead class="table-dark"><tr>\';\n    \n    columns.forEach(col => {\n        const isRequired = col === \'vorname\';\n        const badge = isRequired ? \'<span class="badge bg-danger ms-1">*</span>\' : \'\';\n        html += `<th>${col}${badge}</th>`;\n    });\n    html += \'</tr></thead><tbody>\';\n    \n    data.forEach((row, index) => {\n        html += \'<tr>\';\n        columns.forEach(col => {\n            const value = row[col] || \'\';\n            const isRequired = col === \'vorname\';\n            const isEmpty = !value.trim();\n            const cellClass = isRequired && isEmpty ? \'text-danger fw-bold\' : \'\';\n            html += `<td class="${cellClass}">${value || \'<em class="text-muted">leer</em>\'}</td>`;\n        });\n        html += \'</tr>\';\n    });\n    \n    html += \'</tbody></table>\';\n    container.innerHTML = html;\n}\n\nfunction displayPreviewMessages(errors, warnings) {\n    const container = document.getElementById(\'preview-messages\');\n    \n    if (errors.length === 0 && warnings.length === 0) {\n        container.style.display = \'none\';\n        return;\n    }\n    \n    let html = \'\';\n    \n    if (errors.length > 0) {\n        html += \'<div class="alert alert-danger"><h6><i class="fas fa-exclamation-triangle me-2"></i>Fehler:</h6><ul class="mb-0">\';\n        errors.forEach(error => {\n            html += `<li>${error}</li>`;\n        });\n        html += \'</ul></div>\';\n    }\n    \n    if (warnings.length > 0) {\n        html += \'<div class="alert alert-warning"><h6><i class="fas fa-exclamation-circle me-2"></i>Warnungen:</h6><ul class="mb-0">\';\n        warnings.forEach(warning => {\n            html += `<li>${warning}</li>`;\n        });\n        html += \'</ul></div>\';\n    }\n    \n    container.innerHTML = html;\n    container.style.display = \'block\';\n}\n\n// ============================================================================\n// IMPORT AUSFÜHRUNG\n// ============================================================================\n\nasync function executeImport() {\n    if (!selectedFile || !previewData) {\n        showErrorMessage(\'Keine Datei oder Vorschau-Daten verfügbar\');\n        return;\n    }\n    \n    // Import-Optionen sammeln\n    const duplicateHandling = document.querySelector(\'input[name="duplicate-handling"]:checked\').value;\n    \n    const options = {\n        skip_duplicates: duplicateHandling === \'skip\',\n        update_existing: duplicateHandling === \'update\',\n        import_all: duplicateHandling === \'all\'\n    };\n    \n    try {\n        // UI für Import vorbereiten\n        document.getElementById(\'btn-execute-import\').style.display = \'none\';\n        document.getElementById(\'import-progress\').style.display = \'block\';\n        \n        const formData = new FormData();\n        formData.append(\'file\', selectedFile);\n        formData.append(\'options\', JSON.stringify(options));\n        \n        const response = await fetch(\'/api/kunden/import/execute\', {\n            method: \'POST\',\n            body: formData\n        });\n        \n        const result = await response.json();\n        \n        // Progress ausblenden\n        document.getElementById(\'import-progress\').style.display = \'none\';\n        \n        if (result.success) {\n            displayImportResult(result.result);\n            showSuccessMessage(\'Import erfolgreich abgeschlossen!\');\n        } else {\n            showErrorMessage(\'Fehler beim Import: \' + result.error);\n            document.getElementById(\'btn-execute-import\').style.display = \'block\';\n        }\n        \n    } catch (error) {\n        console.error(\'Fehler beim Import:\', error);\n        showErrorMessage(\'Netzwerkfehler beim Import\');\n        document.getElementById(\'import-progress\').style.display = \'none\';\n        document.getElementById(\'btn-execute-import\').style.display = \'block\';\n    }\n}\n\nfunction displayImportResult(result) {\n    const container = document.getElementById(\'import-result\');\n    \n    let html = \'<div class="card border-success"><div class="card-header bg-success text-white">\';\n    html += \'<h6 class="mb-0"><i class="fas fa-check-circle me-2"></i>Import abgeschlossen</h6>\';\n    html += \'</div><div class="card-body">\';\n    \n    // Statistiken\n    html += \'<div class="row text-center mb-3">\';\n    html += `<div class="col-md-3"><h4 class="text-success">${result.imported_count}</h4><small>Importiert</small></div>`;\n    html += `<div class="col-md-3"><h4 class="text-warning">${result.skipped_count}</h4><small>Übersprungen</small></div>`;\n    html += `<div class="col-md-3"><h4 class="text-danger">${result.error_count}</h4><small>Fehler</small></div>`;\n    html += `<div class="col-md-3"><h4 class="text-info">${result.total_processed}</h4><small>Gesamt</small></div>`;\n    html += \'</div>\';\n    \n    // Fehler anzeigen falls vorhanden\n    if (result.errors && result.errors.length > 0) {\n        html += \'<div class="alert alert-warning"><h6>Aufgetretene Fehler:</h6><ul class="mb-0">\';\n        result.errors.forEach(error => {\n            html += `<li>${error}</li>`;\n        });\n        if (result.error_count > result.errors.length) {\n            html += `<li><em>... und ${result.error_count - result.errors.length} weitere Fehler</em></li>`;\n        }\n        html += \'</ul></div>\';\n    }\n    \n    html += \'</div></div>\';\n    \n    container.innerHTML = html;\n    container.style.display = \'block\';\n}\n\n// ============================================================================\n// TOAST-SYSTEM (gleich wie in anderen Seiten)\n// ============================================================================\n\nfunction showToast(message, type = \'info\', duration = 5000) {\n    const toastContainer = document.getElementById(\'toast-container\');\n    const toastId = \'toast-\' + Date.now();\n    \n    let icon = \'\';\n    let bgClass = \'\';\n    \n    switch(type) {\n        case \'success\':\n            icon = \'<i class="fas fa-check-circle me-2"></i>\';\n            bgClass = \'bg-success\';\n            break;\n        case \'danger\':\n        case \'error\':\n            icon = \'<i class="fas fa-exclamation-triangle me-2"></i>\';\n            bgClass = \'bg-danger\';\n            break;\n        case \'warning\':\n            icon = \'<i class="fas fa-exclamation-circle me-2"></i>\';\n            bgClass = \'bg-warning text-dark\';\n            break;\n        default:\n            icon = \'<i class="fas fa-info-circle me-2"></i>\';\n            bgClass = \'bg-info\';\n    }\n    \n    const toastHTML = `\n        <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert" aria-live="assertive" aria-atomic="true">\n            <div class="d-flex">\n                <div class="toast-body">\n                    ${icon}${message}\n                </div>\n                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n            </div>\n        </div>\n    `;\n    \n    toastContainer.insertAdjacentHTML(\'beforeend\', toastHTML);\n    \n    const toastElement = document.getElementById(toastId);\n    const bsToast = new bootstrap.Toast(toastElement, { delay: duration });\n    \n    bsToast.show();\n    \n    toastElement.addEventListener(\'hidden.bs.toast\', function() {\n        toastElement.remove();\n    });\n    \n    return bsToast;\n}\n\nfunction showSuccessMessage(message) {\n    showToast(message, \'success\');\n}\n\nfunction showErrorMessage(message) {\n    showToast(message, \'error\');\n}\n\nfunction showInfoMessage(message) {\n    showToast(message, \'info\');\n}\n\nfunction showWarningMessage(message) {\n    showToast(message, \'warning\');\n}\n\n// ============================================================================\n// INITIALISIERUNG\n// ============================================================================\n\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    // Ersten Schritt anzeigen\n    showStep(1);\n    \n    // Upload-Area Click-Handler\n    document.getElementById(\'upload-area\').addEventListener(\'click\', function() {\n        document.getElementById(\'file-input\').click();\n    });\n});\n</script>\n{% endblock %}\n